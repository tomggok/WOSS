//
//  DYBShareinstaceDelegate.m
//  DYiBan
//
//  Created by NewM on 13-7-31.
//  Copyright (c) 2013年 ZzL. All rights reserved.
//

#import "DYBShareinstaceDelegate.h"
#import "user.h"
#import "DYBUITabbarViewController.h"
#import "NSObject+DragonDatabase.h"
@implementation DYBShareinstaceDelegate
@synthesize sessionID = _sessionID,
            token = _token,
            version = _version,
httpUrl = _httpUrl,curUser=_curUser,currentUserSetting = _currentUserSetting,registUserSetting = _registUserSetting;

@synthesize dateFormatter = _dateFormatter;

static DYBShareinstaceDelegate *sharedInstace = nil;

+ (DYBShareinstaceDelegate *)sharedInstace
{
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        if (!sharedInstace)
        {
            sharedInstace = [[DYBShareinstaceDelegate alloc] init];
        }
    });
    return sharedInstace;

}

//清楚sharedinstance
- (void)cleanValue
{
    RELEASE(SHARED.sessionID);
    RELEASE(SHARED.token);
    RELEASE(SHARED.token);
    RELEASE(SHARED.version);
    RELEASE(SHARED.httpUrl)
    
    RELEASEOBJ(SHARED.currentUserSetting);
    RELEASEOBJ(SHARED.registUserSetting);
}

#pragma mark -
#pragma mark appMessage
- (NSString *)sessionID
{
    if (!_sessionID || _sessionID.length == 0)
    {
        _sessionID = @"";//要做改的
    }
    return _sessionID;
}

- (NSString *)version
{
    if (!_version || _version.length == 0)
    {
        NSBundle * bundle = [NSBundle mainBundle];
        _version = [NSString stringWithFormat:@"%@", [bundle objectForInfoDictionaryKey:@"CFBundleVersion"]];
    }
    
    return _version;
}

- (NSString *)token
{
    return _token ? _token : @"";
}

#pragma mark -
#pragma mark method
//一般字体统一    ,这种字体在 sizeFit()方法后,字体内容在其frame里偏高
+ (UIFont *)DYBFoutStyle:(CGFloat)fontSize
{
    return [UIFont fontWithName:@"STHeitiSC-Light" size:fontSize];
}

#pragma mark -获取user里的usertype
-(NSString *)getUsertype:(int)type
{
    switch (type) {
        case 0:
            return @"学生";
        case 1:
            return @"辅导员";
        case 2:
            return @"领导";
        case 3:
            return @"施政老师";
        default:
            break;
    }
    return @"";
}

+(void)opeartionTabBarShow:(BOOL)key animated:(BOOL)animated{

    DYBUITabbarViewController *tabBatC = [DYBUITabbarViewController sharedInstace];
    
    if (key) {
        
        [tabBatC hideTabBar:YES animated:animated];
    }else{
        
        [tabBatC hideTabBar:NO animated:animated];
    }
    
    
}

+(void)opeartionTabBarShow:(BOOL)key{
    
    DYBUITabbarViewController *tabBatC = [DYBUITabbarViewController sharedInstace];
    
    if (key) {
        
        [tabBatC hideTabBar:YES animated:YES];
    }else{
        
        [tabBatC hideTabBar:NO animated:YES];
    }
    
    
}

//初始化dateformatter
- (NSDateFormatter *)dateFormatter
{
    if (!_dateFormatter)
    {
        _dateFormatter = [[NSDateFormatter alloc] init];
    }
    return _dateFormatter;
}

//获得sql的用户信息
+(NSDictionary *)userList
{
    self.DB.FROM(kYIBANUSERTABLE).WHERE(@"logintype", @"1").GET();
    
    NSDictionary *userDict = nil;
    if ([self.DB.resultArray count] > 0)
    {
        userDict = [self.DB.resultArray objectAtIndex:0];
    }
    return userDict;
}
//创建易班数据库
+ (void)creatTable
{
    //创建user表
    self.DB.TABLE(kYIBANUSERTABLE).FIELD(@"id", @"integer").PRIMARY_KEY().AUTO_INREMENT()
    .FIELD(@"username", @"TEXT")
    .FIELD(@"password", @"TEXT")
    .FIELD(@"userid", @"TEXT")
    .FIELD(@"sessionID", @"TEXT")
    .FIELD(@"logintime", @"TEXT")
    .FIELD(@"logintype", @"TEXT").CREATE_IF_NOT_EXISTS();
    
    //创建资料库表
    self.DB.TABLE(kDATABANKTABLE).FIELD(@"id",@"integer").PRIMARY_KEY().AUTO_INREMENT()
    .FIELD(@"url",@"TEXT")
    .FIELD(@"md5String",@"TEXT")
    
    .CREATE_IF_NOT_EXISTS();
    
    //离线文件列表
    self.DB.TABLE(kDATABANKOFFLINELISTTABLE).FIELD(@"id",@"integer").PRIMARY_KEY().AUTO_INREMENT()
    .FIELD(@"name",@"TEXT").CREATE_IF_NOT_EXISTS();
    
}



//提示框
+ (DYBDataBankShotView *)addConfirmViewTitle:(NSString *)title MSG:(NSString *)strMSG targetView:(UIView *)view targetObj:(id)Obj btnType:(int)type
{
    DYBDataBankShotView *showView = [[DYBDataBankShotView alloc]initWithFrame:view.bounds type:type  title:title MSG:strMSG];
    showView.hidden = NO;
    [showView setReceive:Obj];
    [view addSubview:showView];
    RELEASE(showView);
    
    return showView;
}

//需要传row 的提示框
+ (DYBDataBankShotView *)addConfirmViewTitle:(NSString *)title MSG:(NSString *)strMSG targetView:(UIView *)view targetObj:(id)Obj btnType:(int)type rowNum:(NSString *)row{
    
    DYBDataBankShotView *showView = [self addConfirmViewTitle:title MSG:strMSG targetView:view targetObj:Obj btnType:type ];
    showView.rowNum = [NSNumber numberWithInt:[row integerValue]];
    return showView;
}

//加载提示可以设置时间
+ (DragonUIPopAlertView *)loadFinishAlertView:(NSString *)text target:(id)target showTime:(CGFloat)time
{
    CGSize frame = MAINSIZE;
    AppDelegate *appDelegate = APPDELEGATE;
    UIWindow *window = appDelegate.window;
    
    
    DragonUIPopAlertView *pop = [[DragonUIPopAlertView alloc] init];
    [pop setDelegate:target];
    [pop setMode:DRAGONPOPALERTVIEWNOINDICATOR];
    [pop setNeedSelfY:YES];
    [pop setAlertViewY:(frame.height - 66)];
    
    [window addSubview:pop];
    [pop setText:text];
    
    [pop alertViewAutoHidden:time isRelease:YES];
    
    return pop;
}

<<<<<<< .mine
+ (void)getDataBankCancheFile{



}
=======
//提示数据加载完毕
+ (DragonUIPopAlertView *)loadFinishAlertView:(NSString *)text target:(id)target
{
    return [DYBShareinstaceDelegate loadFinishAlertView:text target:target showTime:.5f];
}

>>>>>>> .r8908
@end
